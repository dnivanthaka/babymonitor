<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>The best baby monitor</title>
<style type="text/css">
body{
	padding: 0;
	margin: 0;
	background-color: #20B2AA;
}
#bodyContainer{
	width: 380px;
	margin: 0 auto;
	/*border: 1px solid #000;*/
}

#streamContainer img{
	/*padding: 2px;*/
	display: block;
	margin: 0 auto;
	border: 2px solid red;
}

#streamContainer{
	width: 100%;
	margin: 0 auto;
	/*border: 1px solid #000;*/
}

#streamControl{
	width: 80%;
	margin:0 auto;
}

#eventStream{
	padding: 2px;
}
</style>
<script type="text/javascript">
	window.onload = function(){
		var url = window.location.href;
		var host = url.substring(0, url.lastIndexOf("/"));
		//alert("It works!!!");
		var img = document.getElementById("outStream");
		img.src = host+":9090/stream/video.mjpeg";
		//alert(host);
		var list = document.getElementById("list");
		var entry = document.createElement("li");
		entry.appendChild(document.createTextNode("This is a test"));
		list.insertBefore(entry, list.firstChild);
		updateMotionStatus();
		//setTimeout(function(){soundAlarm()}, 5000);
		setInterval(function(){updateMotionStatus()}, 5000);
	}
function updateMotionStatus(){
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var mList = this.responseText.split("\n");
	    var list = document.getElementById("list");
	    list.innerHTML = '';
	    for(var i=0;i<(mList.length - 1);i++){
            	var entry = document.createElement("li");
            	entry.appendChild(document.createTextNode(mList[i]));
            	list.insertBefore(entry, list.firstChild);
	    }
       }
    };
    xhttp.open("GET", "cgi-bin/getmotion.sh", true);
    xhttp.send();
}

function refreshStream(){
	var img = document.getElementById("outStream");
	var url = img.src;
	img.src = '';
	img.src = url;
}

function soundAlarm(){
		var audio = new Audio('0956.ogg');
		audio.play();
}
</script>
</head>

<body>
<div id="bodyContainer">
	<div id="streamContainer">
		<img id="outStream" src=""/>
	</div>
	<div id="streamControl">
		<button type="button" onclick="refreshStream()" id="streamRefresh">Refresh Video</button>
		<button type="button" onclick="window.location.reload()">Refresh Page</button>
		<a href="control.html"><button type="button">Device Control</button></a>
	</div>
	<div id="eventStream">
		<h3>Event Log</h3>
		<div>
			<ul id="list">
				<li>No Events</li>
			</ul>
		</div>
	</div>
</div>

</body>
</html>
